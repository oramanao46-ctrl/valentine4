<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Valentine - 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ff5c8a;
            --secondary: #ffacc5;
            --accent: #5e3040;
            --bg: #fff5f7;
        }

        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--bg);
            color: var(--accent);
            margin: 0; padding: 0;
            overflow: hidden;
            height: 100vh; width: 100vw;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- BACKGROUND FLOATERS --- */
        .bg-floaters {
            position: fixed; width: 100%; height: 100%; top: 0; left: 0;
            pointer-events: none; z-index: 0; overflow: hidden;
        }
        .floater {
            position: absolute; bottom: -50px;
            animation: floatUp linear infinite; opacity: 0.6;
        }
        @keyframes floatUp { 
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            10% { opacity: 0.6; }
            100% { transform: translateY(-110vh) rotate(360deg); opacity: 0; }
        }

        /* --- PAGES --- */
        .page {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.5s; z-index: 10;
            padding: 20px; box-sizing: border-box;
        }
        .active { display: flex; }

        /* --- PAGE 1: ENVELOPE --- */
        .chase-area { position: relative; width: 100%; height: 100%; }
        .flying-envelope {
            position: absolute; width: 140px; height: 90px;
            cursor: pointer; z-index: 20; transition: transform 0.2s ease-out;
        }
        .env-body { font-size: 6rem; line-height: 1; text-align: center; }
        .wing {
            position: absolute; top: 30px; width: 70px; height: 40px;
            background: rgba(255,255,255,0.9); border: 2px solid #eec; border-radius: 50%; z-index: 1;
        }
        .wing.left { left: -15px; transform-origin: right center; animation: flapL 0.2s infinite alternate; }
        .wing.right { right: -15px; transform-origin: left center; animation: flapR 0.2s infinite alternate; }
        @keyframes flapL { from { transform: rotate(-25deg); } to { transform: rotate(35deg); } }
        @keyframes flapR { from { transform: rotate(25deg); } to { transform: rotate(-35deg); } }
        
        .music-hint {
            position: absolute; bottom: 15%; width: 100%; text-align: center;
            animation: pulse 1.5s infinite; color: var(--primary);
        }
        @keyframes pulse { 50% { opacity: 0.6; transform: scale(0.95); } }

        /* --- PAGE 2: TIMER --- */
        .timer-display {
            font-size: 1rem; color: var(--primary); 
            background: white; padding: 15px 20px; border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-bottom: 20px;
            text-align: center; line-height: 1.6;
        }
        .heart-container {
            width: 180px; height: 160px; position: relative; cursor: pointer;
            transition: transform 0.1s; filter: drop-shadow(0 10px 20px rgba(255, 92, 138, 0.4));
        }

        /* --- PAGE 3: SCRATCH --- */
        .scratch-box {
            position: relative; width: 280px; height: 280px;
            border: 8px solid white; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); overflow: hidden;
        }

        /* --- PAGE 4: HIDDEN OBJECTS --- */
        .room-scene {
            width: 100%; height: 100%; position: relative;
            background-image: url('photo6.jpg'); 
            background-size: cover; background-position: center;
        }
        .hidden-item {
            position: absolute; width: 40px; height: 50px; cursor: pointer;
            background: white; padding: 2px; border-radius: 2px; box-shadow: 0 3px 8px rgba(0,0,0,0.3);
        }
        .hidden-item img { width: 100%; height: 100%; object-fit: cover; }
        .inventory {
            position: absolute; top: 10px; width: 90%;
            background: rgba(255,255,255,0.9); padding: 5px; border-radius: 10px;
            display: grid; grid-template-columns: repeat(6, 1fr); gap: 3px; z-index: 50;
        }
        .inv-slot {
            height: 35px; background: #eee; border-radius: 4px; overflow: hidden;
            display: flex; align-items: center; justify-content: center; font-size: 0.6rem;
        }
        .inv-slot.filled { border: 1px solid var(--primary); }
        .inv-slot img { width: 100%; height: 100%; object-fit: cover; }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 100;
            display: none; align-items: center; justify-content: center; padding: 20px;
        }
        .modal-card {
            background: white; padding: 15px; border-radius: 15px;
            max-width: 300px; text-align: center;
        }
        .modal-card img { width: 100%; border-radius: 10px; margin-bottom: 10px; }
        .btn-keep {
            background: var(--primary); color: white; border: none;
            padding: 10px 20px; border-radius: 20px; margin-top: 10px; font-family: 'Kanit';
        }

        /* --- FINAL MESSAGE --- */
        .final-msg-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 200;
            display: none; flex-direction: column; overflow-y: auto;
            padding: 40px 20px; text-align: center; box-sizing: border-box;
        }
        .final-msg-box h1 { color: var(--primary); margin-bottom: 20px; }
        .final-msg-box p { line-height: 1.8; color: #444; white-space: pre-line; }

    </style>
</head>
<body onclick="playAudio()">

    <audio id="bgm" loop><source src="song.mp3" type="audio/mpeg"></audio>
    <div class="bg-floaters" id="bgFloaters"></div>

    <div id="page1" class="page active">
        <div class="chase-area">
            <h2 style="text-align:center; margin-top:80px;">‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏ô‡∏µ‡πâ‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏¢‡πà‡∏á‡∏ä‡∏¥‡∏á‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏ô‡∏∞! üíå</h2>
            <div class="flying-envelope" id="envelope" onmouseover="moveEnv()" ontouchstart="moveEnvMobile(event)">
                <div class="wing left"></div><div class="env-body">üíå</div><div class="wing right"></div>
            </div>
        </div>
        <div class="music-hint">üéµ ‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡πÄ‡∏û‡∏•‡∏á üéµ</div>
    </div>

    <div id="page2" class="page">
        <h2>‡∏à‡∏∏‡∏î‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤...</h2>
        <div class="timer-display" id="knowTimer">‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß: ...</div>
        <div class="timer-display" id="loveTimer" style="font-weight: 600;">‡∏Ñ‡∏ö‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß: ...</div>
        
        <div class="heart-container" onclick="fillHeart()">
            <svg viewBox="0 0 200 200" width="100%" height="100%">
                <defs>
                    <mask id="heartMask"><path d="M100,180 C20,130 0,80 0,50 C0,20 25,0 55,0 C75,0 90,15 100,30 C110,15 125,0 145,0 C175,0 200,20 200,50 C200,80 180,130 100,180 Z" fill="white"/></mask>
                    <linearGradient id="pinkGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#ff9a9e;" /><stop offset="100%" style="stop-color:#fecfef;" /></linearGradient>
                </defs>
                <path d="M100,180 C20,130 0,80 0,50 C0,20 25,0 55,0 C75,0 90,15 100,30 C110,15 125,0 145,0 C175,0 200,20 200,50 C200,80 180,130 100,180 Z" fill="none" stroke="#ff5c8a" stroke-width="4" />
                <rect x="0" y="200" width="200" height="200" fill="url(#pinkGrad)" mask="url(#heartMask)" id="waterLevel"></rect>
            </svg>
            <div style="position:absolute; top:45%; width:100%; text-align:center; color:#fff; font-weight:bold;"><span id="percent">0%</span></div>
        </div>
        <p class="tap-msg">üëÜ ‡∏à‡∏¥‡πâ‡∏°‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÄ‡∏ï‡∏¥‡∏°‡∏£‡∏±‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°!</p>
    </div>

    <div id="page3" class="page">
        <h2>‡∏Ç‡∏π‡∏î‡πÄ‡∏•‡∏¢‡∏¢... ‚ú®</h2>
        <div class="scratch-box">
            <img src="photo1.jpg" style="width:100%; height:100%; object-fit:cover;">
            <canvas id="scratchCanvas" width="280" height="280" style="position:absolute; top:0; left:0;"></canvas>
        </div>
        <p style="margin-top:15px; color:#888;">‡∏Ç‡∏π‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏£‡∏á‡∏à‡∏≥‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏î‡∏ô‡∏∞</p>
    </div>

    <div id="page4" class="page" style="padding:0;">
        <div class="inventory" id="inventory">
            <div class="inv-slot" id="slot1"></div><div class="inv-slot" id="slot2"></div><div class="inv-slot" id="slot3"></div>
            <div class="inv-slot" id="slot4"></div><div class="inv-slot" id="slot5"></div><div class="inv-slot" id="slot7"></div>
            <div class="inv-slot" id="slot8"></div><div class="inv-slot" id="slot9"></div><div class="inv-slot" id="slot10"></div>
            <div class="inv-slot" id="slot11"></div><div class="inv-slot" id="slot12"></div>
        </div>
        <div class="room-scene" id="roomScene">
            </div>
    </div>

    <div class="modal-overlay" id="previewModal">
        <div class="modal-card">
            <img src="" id="previewImg">
            <p id="previewCaption" style="font-weight:600; color:#555;"></p>
            <button class="btn-keep" onclick="confirmKeep()">‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏™‡πà‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ ‚ù§Ô∏è</button>
        </div>
    </div>

    <div class="final-msg-container" id="finalPage">
        <div class="final-msg-box">
            <h1>Day, My Love</h1>
            <p id="finalText"></p>
            <p style="margin-top:30px; font-weight:bold;">With Love ü§ç</p>
        </div>
    </div>

    <script>
        // --- CONFIG ---
        const dateKnown = new Date(2025, 3, 7); // 7 ‡πÄ‡∏°‡∏©‡∏≤ (Month is 0-indexed)
        const dateLove = new Date(2025, 4, 1);  // 1 ‡∏û‡∏§‡∏©‡∏†‡∏≤
        
        const photoData = [
            { id: 1, src: "photo1.jpg", text: "1. I love you more than words can say." },
            { id: 2, src: "photo2.jpg", text: "2. You are my favorite person in the whole world." },
            { id: 3, src: "photo3.jpg", text: "3. Every day with you is my happiest day." },
            { id: 4, src: "photo4.jpg", text: "4. I fall in love with you a little more every day." },
            { id: 5, src: "photo5.jpg", text: "5. You make my heart smile." },
            { id: 7, src: "photo7.jpg", text: "7. Life is sweeter because of you." },
            { id: 8, src: "photo8.jpg", text: "8. You are my sunshine on cloudy days." },
            { id: 9, src: "photo9.jpg", text: "9. I‚Äôm so lucky to have you in my life." },
            { id: 10, src: "photo10.jpg", text: "10. My heart is yours, always." },
            { id: 11, src: "photo11.jpg", text: "11. You are my smile, my love, my everything." },
            { id: 12, src: "photo12.jpg", text: "12. Happy Valentine's Day!" }
        ];

        const finalLetter = `My love,

        Happy Valentine‚Äôs Day üíñ

        I just want you to know how incredibly grateful I am
        to have you in my life.
        You are not just my partner,
        but my safe place,
        my smile on hard days,
        and my happiness on ordinary days.
        Every moment with you makes my world brighter.

        Your smile warms my heart,
        your voice makes me feel calm,
        and your love makes me feel complete.
        I love the way you care,
        the way you laugh,
        and the way you make me feel special
        without even trying.
        Thank you for loving me the way you do,
        for always being by my side,
        and for choosing me every single day.
        I promise to keep loving you more and more,
        today, tomorrow, and always.

        You are my Valentine,
        my favorite person,
        and my forever.

        I love you so much ü§ç`;

        // --- CORE LOGIC ---
        let collected = 0;
        let activeId = null;
        let activeEl = null;

        function goTo(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            const target = document.getElementById(id);
            target.classList.add('active');
            if(id === 'page2') startTimers();
            if(id === 'page3') initScratch();
            if(id === 'page4') initGallery();
        }

        // --- AUDIO ---
        let audioStarted = false;
        function playAudio() {
            if(!audioStarted) {
                document.getElementById('bgm').play().catch(()=>{});
                audioStarted = true;
            }
        }

        // --- PAGE 1 ---
        const env = document.getElementById('envelope');
        let touchCount = 0;
        function moveEnv() {
            const x = Math.random() * (window.innerWidth - 100);
            const y = Math.random() * (window.innerHeight - 100);
            env.style.left = x + 'px'; env.style.top = y + 'px';
        }
        function moveEnvMobile(e) {
            touchCount++;
            if(touchCount < 5) { e.preventDefault(); moveEnv(); }
            else { goTo('page2'); }
        }
        env.onclick = () => goTo('page2');

        // --- PAGE 2: TIMERS ---
        function startTimers() {
            setInterval(() => {
                const now = new Date();
                const update = (start, elId, prefix) => {
                    const diff = now - start;
                    const d = Math.floor(diff / (1000*60*60*24));
                    const h = Math.floor((diff/(1000*60*60))%24);
                    const m = Math.floor((diff/(1000*60))%60);
                    const s = Math.floor((diff/1000)%60);
                    document.getElementById(elId).innerText = `${prefix}: ${d} ‡∏ß‡∏±‡∏ô ${h} ‡∏ä‡∏°. ${m} ‡∏ô‡∏≤‡∏ó‡∏µ ${s} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
                };
                update(dateKnown, 'knowTimer', '‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏Å‡∏±‡∏ô‡∏°‡∏≤');
                update(dateLove, 'loveTimer', '‡∏Ñ‡∏ö‡∏Å‡∏±‡∏ô‡∏°‡∏≤');
            }, 1000);
        }

        let lovePercent = 0;
        function fillHeart() {
            lovePercent += 10;
            if(lovePercent > 100) lovePercent = 100;
            document.getElementById('waterLevel').setAttribute('y', 200 - (2 * lovePercent));
            document.getElementById('percent').innerText = lovePercent + "%";
            if(lovePercent >= 100) setTimeout(() => goTo('page3'), 600);
        }

        // --- PAGE 3: SCRATCH (70%) ---
        function initScratch() {
            const canvas = document.getElementById('scratchCanvas');
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = '#C0C0C0'; ctx.fillRect(0,0,280,280);
            
            let painting = false;
            const scratch = (x, y) => {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.beginPath(); ctx.arc(x, y, 25, 0, Math.PI*2); ctx.fill();
                checkScratch();
            };
            
            const checkScratch = () => {
                const data = ctx.getImageData(0,0,280,280).data;
                let cleared = 0;
                for(let i=3; i<data.length; i+=4) if(data[i] === 0) cleared++;
                if(cleared / (280*280) > 0.7) { // 70% threshold
                    canvas.style.transition = 'opacity 1s';
                    canvas.style.opacity = '0';
                    setTimeout(() => goTo('page4'), 1200);
                }
            };

            const getPos = (e) => {
                const rect = canvas.getBoundingClientRect();
                const ev = e.touches ? e.touches[0] : e;
                return [ev.clientX - rect.left, ev.clientY - rect.top];
            };

            canvas.onmousedown = (e) => { painting = true; scratch(...getPos(e)); };
            canvas.onmousemove = (e) => { if(painting) scratch(...getPos(e)); };
            window.onmouseup = () => painting = false;
            canvas.ontouchstart = (e) => { painting = true; scratch(...getPos(e)); e.preventDefault(); };
            canvas.ontouchmove = (e) => { if(painting) scratch(...getPos(e)); e.preventDefault(); };
        }

        // --- PAGE 4: GALLERY ---
        function initGallery() {
            const scene = document.getElementById('roomScene');
            photoData.forEach(p => {
                const el = document.createElement('div');
                el.className = 'hidden-item';
                el.style.left = (10 + Math.random() * 70) + '%';
                el.style.top = (20 + Math.random() * 60) + '%';
                el.style.transform = `rotate(${(Math.random()*40)-20}deg)`;
                el.innerHTML = `<img src="${p.src}">`;
                el.onclick = () => {
                    activeId = p.id; activeEl = el;
                    document.getElementById('previewImg').src = p.src;
                    document.getElementById('previewCaption').innerText = p.text;
                    document.getElementById('previewModal').style.display = 'flex';
                };
                scene.appendChild(el);
            });
        }

        function confirmKeep() {
            document.getElementById('previewModal').style.display = 'none';
            activeEl.style.display = 'none';
            const slot = document.getElementById('slot' + activeId);
            slot.innerHTML = `<img src="${activeEl.querySelector('img').src}">`;
            slot.classList.add('filled');
            collected++;
            if(collected === photoData.length) {
                setTimeout(showFinal, 1000);
            }
        }

        function showFinal() {
            const finalPage = document.getElementById('finalPage');
            document.getElementById('finalText').innerText = finalLetter;
            finalPage.style.display = 'block';
            // Background floaters for final
            setInterval(() => {
                let el = document.createElement('div');
                el.className = 'floater';
                el.innerText = 'üíñ';
                el.style.left = Math.random() * 100 + '%';
                el.style.animationDuration = '5s';
                document.body.appendChild(el);
            }, 300);
        }

        // Init floating hearts
        for(let i=0; i<15; i++) {
            let el = document.createElement('div');
            el.className = 'floater';
            el.innerText = ['‚ù§Ô∏è','‚ú®','üå∏'][Math.floor(Math.random()*3)];
            el.style.left = Math.random() * 100 + '%';
            el.style.animationDuration = (5 + Math.random()*5) + 's';
            el.style.animationDelay = (Math.random()*5) + 's';
            document.getElementById('bgFloaters').appendChild(el);
        }
    </script>
</body>
</html>
