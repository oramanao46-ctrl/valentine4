<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Happy Valentine's Day</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ff5c8a;
            --secondary: #ffacc5;
            --accent: #5e3040;
            --bg: #fff5f7;
        }

        body {
            font-family: 'Kanit', sans-serif;
            background-color: var(--bg);
            color: var(--accent);
            margin: 0; padding: 0;
            overflow: hidden;
            height: 100vh; width: 100vw;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- BACKGROUND FLOATERS --- */
        .bg-floaters {
            position: fixed; width: 100%; height: 100%; top: 0; left: 0;
            pointer-events: none; z-index: 0; overflow: hidden;
        }
        .floater {
            position: absolute; bottom: -50px;
            animation: floatUp linear infinite; opacity: 0.6;
        }
        @keyframes floatUp { 
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            10% { opacity: 0.6; }
            100% { transform: translateY(-110vh) rotate(360deg); opacity: 0; }
        }

        .page {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.5s; z-index: 10;
            padding: 20px; box-sizing: border-box;
        }
        .active { display: flex; }

        /* --- PAGE 2: TIMER & HEART --- */
        .timer-display {
            font-size: 0.95rem; color: var(--primary); 
            background: white; padding: 12px 20px; border-radius: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08); margin-bottom: 15px;
            font-weight: 400; text-align: center; width: 90%;
        }
        .heart-container {
            width: 180px; height: 160px; position: relative; cursor: pointer;
            transition: transform 0.1s; filter: drop-shadow(0 10px 20px rgba(255, 92, 138, 0.4));
        }

        /* --- PAGE 3: SCRATCH --- */
        .scratch-box {
            position: relative; width: 280px; height: 280px;
            border: 8px solid white; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); overflow: hidden;
        }

        /* --- PAGE 4: HUNTING --- */
        .room-scene {
            width: 100%; height: 100%; position: relative; overflow: hidden;
            background-image: url('photo6.jpg'); background-size: cover; background-position: center;
        }
        .inventory {
            position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
            background: rgba(255,255,255,0.95); padding: 5px; border-radius: 12px;
            display: grid; grid-template-columns: repeat(6, 1fr); gap: 4px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15); z-index: 50; width: 95%;
        }
        .inv-slot {
            width: 42px; height: 42px; background: #eee; border-radius: 6px;
            display: flex; align-items: center; justify-content: center; overflow: hidden;
        }
        .inv-slot img { width: 100%; height: 100%; object-fit: cover; }
        .hidden-item {
            position: absolute; width: 35px; height: 45px; cursor: pointer;
            background: white; padding: 2px; border-radius: 3px; box-shadow: 0 3px 6px rgba(0,0,0,0.3);
        }
        .hidden-item img { width: 100%; height: 100%; object-fit: cover; }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); z-index: 100; display: none; align-items: center; justify-content: center;
        }
        .modal-card { background: white; padding: 15px; border-radius: 15px; max-width: 80%; text-align: center; }
        .modal-card img { width: 100%; border-radius: 10px; }

        /* --- FINAL --- */
        .final-msg-container {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: white; z-index: 200; display: none; flex-direction: column; padding: 30px;
            overflow-y: auto; text-align: center;
        }
        .final-msg-container.show-final { display: flex; }
        .final-msg-box p { line-height: 1.8; color: #444; white-space: pre-wrap; text-align: center; font-size: 1rem; }
    </style>
</head>
<body onclick="playAudio()">

    <audio id="bgm" loop><source src="song.mp3" type="audio/mpeg"></audio>
    <div class="bg-floaters" id="bgFloaters"></div>

    <div id="page1" class="page active">
        <div class="chase-area">
            <h2 style="text-align:center; margin-top:80px;">‡∏à‡∏î‡∏´‡∏°‡∏≤‡∏¢‡∏£‡∏±‡∏Å‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ<br>‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏ô‡∏∞! üòù</h2>
            <div class="flying-envelope" id="envelope" onmouseover="moveEnv()" ontouchstart="moveEnvMobile(event)">
                <div class="wing left"></div><div class="env-body">üíå</div><div class="wing right"></div>
            </div>
        </div>
        <div class="music-hint" style="bottom: 15%;">üéµ ‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏° üéµ</div>
    </div>

    <div id="page2" class="page">
        <div class="timer-display" id="knowTimer"></div>
        <div class="timer-display" id="loveTimer"></div>
        <div class="heart-container" onclick="fillHeart()">
            <svg viewBox="0 0 200 200" width="100%" height="100%">
                <defs>
                    <mask id="heartMask"><path d="M100,180 C20,130 0,80 0,50 C0,20 25,0 55,0 C75,0 90,15 100,30 C110,15 125,0 145,0 C175,0 200,20 200,50 C200,80 180,130 100,180 Z" fill="white"/></mask>
                    <linearGradient id="pinkGrad" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#ff9a9e;stop-opacity:1" /><stop offset="100%" style="stop-color:#fecfef;stop-opacity:1" /></linearGradient>
                </defs>
                <path d="M100,180 C20,130 0,80 0,50 C0,20 25,0 55,0 C75,0 90,15 100,30 C110,15 125,0 145,0 C175,0 200,20 200,50 C200,80 180,130 100,180 Z" fill="none" stroke="#ff5c8a" stroke-width="4" />
                <rect x="0" y="200" width="200" height="200" fill="url(#pinkGrad)" mask="url(#heartMask)" id="waterLevel"><transition style="transition: y 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);"></transition></rect>
            </svg>
            <div style="position:absolute; top:45%; width:100%; text-align:center; color:#fff; font-weight:bold;"><span id="percent">0%</span></div>
        </div>
        <p class="tap-msg" style="margin-top:20px;">üëÜ ‡∏à‡∏¥‡πâ‡∏°‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÄ‡∏ï‡∏¥‡∏°‡∏£‡∏±‡∏Å‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°!</p>
    </div>

    <div id="page3" class="page">
        <h2 style="margin-bottom:20px;">‡∏Ç‡∏π‡∏î‡πÄ‡∏•‡∏¢‡∏¢...</h2>
        <div class="scratch-box">
            <img src="photo1.jpg" style="width:100%; height:100%; object-fit:cover;">
            <canvas id="scratchCanvas" width="280" height="280" style="position:absolute; top:0; left:0; cursor:pointer;"></canvas>
        </div>
        <p style="margin-top:15px; color:#888;">‡∏Ç‡∏π‡∏î‡πÉ‡∏´‡πâ‡∏ñ‡∏∂‡∏á 70% ‡∏ô‡∏∞‡∏Ñ‡∏∞</p>
    </div>

    <div id="page4" class="page" style="padding:0;">
        <div class="inventory" id="inventory"></div>
        <div class="room-scene" id="roomScene"></div>
    </div>

    <div class="modal-overlay" id="previewModal">
        <div class="modal-card">
            <img src="" id="previewImg">
            <p id="previewCaption" style="font-weight:600; color:#555; padding:10px;"></p>
            <button onclick="confirmKeep()" style="background:var(--primary); color:white; border:none; padding:10px 25px; border-radius:30px; font-family:'Kanit';">‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤ ‚ù§Ô∏è</button>
        </div>
    </div>

    <div class="final-msg-container" id="finalMsgContainer">
        <div class="final-msg-box">
            <h1 style="color:var(--primary);">Day, My Love</h1>
            <p id="finalText"></p>
        </div>
    </div>

    <script>
        const dateKnow = new Date(2025, 3, 7); // 7 ‡πÄ‡∏°‡∏©‡∏≤ 2568
        const dateLove = new Date(2025, 4, 1); // 1 ‡∏û‡∏Ñ 2568
        
        const photosData = [
            { id: 1, text: "1. I love you more than words can say." },
            { id: 2, text: "2. You are my favorite person in the whole world." },
            { id: 3, text: "3. Every day with you is my happiest day." },
            { id: 4, text: "4. I fall in love with you a little more every day." },
            { id: 5, text: "5. You make my heart smile." },
            { id: 7, text: "7. Life is sweeter because of you." },
            { id: 8, text: "8. You are my sunshine on cloudy days." },
            { id: 9, text: "9. I‚Äôm so lucky to have you in my life." },
            { id: 10, text: "10. My heart is yours, always." },
            { id: 11, text: "11. You are my smile, my love, my everything." },
            { id: 12, text: "12. Our love is forever." }
        ];

        const finalMsg = `My love,

Happy Valentine‚Äôs Day üíñ

I just want you to know how incredibly grateful I am
to have you in my life.
You are not just my partner,
but my safe place,
my smile on hard days,
and my happiness on ordinary days.

Every moment with you makes my world brighter.
Your smile warms my heart,
your voice makes me feel calm,
and your love makes me feel complete.

I love the way you care,
the way you laugh,
and the way you make me feel special
without even trying.

Thank you for loving me the way you do,
for always being by my side,
and for choosing me every single day.

I promise to keep loving you more and more,
today, tomorrow, and always.

You are my Valentine,
my favorite person,
and my forever.

I love you so much ü§ç
With a`;

        let audioPlaying = false;
        function playAudio() {
            if(!audioPlaying) {
                document.getElementById('bgm').play().catch(()=>{});
                audioPlaying = true;
            }
        }

        function goTo(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'page2') startTimers();
            if(id === 'page3') initScratch();
            if(id === 'page4') initHunting();
        }

        function startTimers() {
            setInterval(() => {
                const now = new Date();
                document.getElementById('knowTimer').innerHTML = `‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å‡∏Å‡∏±‡∏ô‡∏°‡∏≤: ${calcTime(now, dateKnow)}`;
                document.getElementById('loveTimer').innerHTML = `‡∏Ñ‡∏ö‡∏Å‡∏±‡∏ô‡∏°‡∏≤: ${calcTime(now, dateLove)}`;
            }, 1000);
        }

        function calcTime(now, start) {
            const diff = now - start;
            const d = Math.floor(diff / 86400000);
            const h = Math.floor((diff % 86400000) / 3600000);
            const m = Math.floor((diff % 3600000) / 60000);
            const s = Math.floor((diff % 60000) / 1000);
            return `${d} ‡∏ß‡∏±‡∏ô ${h} ‡∏ä‡∏°. ${m} ‡∏ô‡∏≤‡∏ó‡∏µ ${s} ‡∏ß‡∏¥`;
        }

        // --- ENVELOPE ---
        const env = document.getElementById('envelope');
        function moveEnv() {
            const x = Math.random() * (window.innerWidth - 150);
            const y = Math.random() * (window.innerHeight - 150);
            env.style.left = x + 'px'; env.style.top = y + 'px';
        }
        let envTouches = 0;
        function moveEnvMobile(e) {
            envTouches++;
            if(envTouches < 5) { e.preventDefault(); moveEnv(); }
            else goTo('page2');
        }
        env.onclick = () => goTo('page2');

        // --- HEART ---
        let heartPercent = 0;
        function fillHeart() {
            heartPercent += 15; if(heartPercent > 100) heartPercent = 100;
            document.getElementById('waterLevel').setAttribute('y', 200 - (200 * (heartPercent/100)));
            document.getElementById('percent').innerText = heartPercent + "%";
            if(heartPercent >= 100) setTimeout(() => goTo('page3'), 800);
        }

        // --- SCRATCH ---
        function initScratch() {
            const c = document.getElementById('scratchCanvas');
            const ctx = c.getContext('2d');
            ctx.fillStyle = '#C0C0C0'; ctx.fillRect(0,0,280,280);
            let drawing = false;
            const scratch = (x,y) => {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.beginPath(); ctx.arc(x,y,25,0,Math.PI*2); ctx.fill();
                const d = ctx.getImageData(0,0,280,280).data;
                let cleared = 0;
                for(let i=3; i<d.length; i+=4) if(d[i] === 0) cleared++;
                if(cleared / (280*280) > 0.7) setTimeout(() => goTo('page4'), 500);
            };
            c.addEventListener('mousedown', () => drawing = true);
            window.addEventListener('mouseup', () => drawing = false);
            c.addEventListener('mousemove', (e) => {
                if(!drawing) return;
                const r = c.getBoundingClientRect();
                scratch(e.clientX - r.left, e.clientY - r.top);
            });
            c.addEventListener('touchstart', (e) => { drawing = true; e.preventDefault(); });
            c.addEventListener('touchmove', (e) => {
                const r = c.getBoundingClientRect();
                scratch(e.touches[0].clientX - r.left, e.touches[0].clientY - r.top);
            });
        }

        // --- HUNTING ---
        let collected = 0;
        let activeItem = null;
        function initHunting() {
            const scene = document.getElementById('roomScene');
            const inv = document.getElementById('inventory');
            scene.innerHTML = ''; inv.innerHTML = '';
            photosData.forEach(p => {
                const slot = document.createElement('div');
                slot.className = 'inv-slot'; slot.id = `slot-${p.id}`;
                inv.appendChild(slot);
                const item = document.createElement('div');
                item.className = 'hidden-item';
                item.style.top = Math.random() * 70 + 15 + '%';
                item.style.left = Math.random() * 80 + 5 + '%';
                item.innerHTML = `<img src="photo${p.id}.jpg">`;
                item.onclick = () => {
                    activeItem = { ...p, el: item };
                    document.getElementById('previewImg').src = `photo${p.id}.jpg`;
                    document.getElementById('previewCaption').innerText = p.text;
                    document.getElementById('previewModal').style.display = 'flex';
                };
                scene.appendChild(item);
            });
        }
        function confirmKeep() {
            document.getElementById('previewModal').style.display = 'none';
            activeItem.el.style.display = 'none';
            const slot = document.getElementById(`slot-${activeItem.id}`);
            slot.innerHTML = `<img src="photo${activeItem.id}.jpg">`;
            collected++;
            if(collected === photosData.length) {
                setTimeout(() => {
                    document.getElementById('finalText').innerText = finalMsg;
                    document.getElementById('finalMsgContainer').classList.add('show-final');
                }, 1000);
            }
        }

        // Floaters
        setInterval(() => {
            const e = document.createElement('div');
            e.className = 'floater';
            e.innerText = ['‚ù§Ô∏è','üå∏','‚ú®','üíñ'][Math.floor(Math.random()*4)];
            e.style.left = Math.random()*100+'%';
            e.style.fontSize = Math.random()*20+15+'px';
            e.style.animationDuration = Math.random()*5+5+'s';
            document.getElementById('bgFloaters').appendChild(e);
            setTimeout(() => e.remove(), 10000);
        }, 600);
    </script>
</body>
</html>
